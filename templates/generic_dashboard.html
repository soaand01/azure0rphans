{% extends "base.html" %}

{% block title %}{{ resource_info.name }} - CostPlan{% endblock %}

{% block nav_links %}
<div class="text-white ms-3">
    <i class="{{ resource_info.icon }} me-2"></i>
    <strong>{{ resource_info.name }}</strong>
</div>
{% endblock %}

{% block extra_css %}
<style>
        body {
            background: #f5f5f5;
        }
        .section-header {
            background: #000;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .stat-card {
            border: 2px solid #e0e0e0;
            background: white;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            border-color: #000;
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,.15);
        }
        .icon-box {
            width: 60px;
            height: 60px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #e0e0e0;
            background: white;
        }
        .icon-box i {
            background: {{ resource_info.gradient }};
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .recommendation-item {
            border-left: 3px solid #000;
            background: white;
            border: 2px solid #e0e0e0;
            border-left: 4px solid #000;
        }
        .recommendation-item:hover {
            box-shadow: 0 0.25rem 0.5rem rgba(0,0,0,.1);
        }
        .data-table {
            border: 2px solid #e0e0e0;
            background: white;
        }
        .resource-row:hover {
            background: #f8f9fa;
        }
        .info-icon {
            color: #6c757d;
            cursor: help;
            margin-left: 0.25rem;
            font-size: 0.875rem;
        }
        .info-icon:hover {
            color: #000;
        }
    </style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Loading Spinner -->
        <div id="loadingSpinner" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Analyzing {{ resource_info.name }}...</p>
        </div>

        <!-- Main Content -->
        <div id="mainContent" style="display: none;">
            
            <!-- Data Source Banner -->
            <div id="dataSourceBanner" class="alert border-0 shadow-sm mb-4" style="display: none;"></div>
            
            <!-- Page Header -->
            <div class="section-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h4 class="mb-1"><i class="{{ resource_info.icon }} me-2"></i>{{ resource_info.name }} Analysis</h4>
                        <small style="opacity: 0.9;">{{ resource_info.description }}</small>
                    </div>
                    <div>
                        <i class="bi bi-graph-up-arrow fs-3"></i>
                    </div>
                </div>
            </div>

            <!-- Cost Impact Dashboard -->
            <div class="row mb-4">
                <div class="col-lg-4">
                    <div class="card stat-card border-0 shadow-sm h-100">
                        <div class="card-body">
                            <h6 class="text-muted mb-3">
                                <i class="bi bi-cash-coin me-2"></i>Monthly Waste
                                <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                   title="The estimated monthly cost you're paying for resources that are not being used or are orphaned. Cleaning these up will immediately reduce your Azure bill."></i>
                            </h6>
                            <h2 class="mb-2 text-danger" id="monthlyWaste">$0</h2>
                            <p class="mb-0 small text-muted">Estimated cost of orphaned resources</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card stat-card border-0 shadow-sm h-100">
                        <div class="card-body">
                            <h6 class="text-muted mb-3">
                                <i class="bi bi-piggy-bank me-2"></i>Annual Savings
                                <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                   title="The total amount you could save per year by removing all orphaned resources. This is Monthly Waste × 12, representing your annual cost reduction opportunity."></i>
                            </h6>
                            <h2 class="mb-2 text-success" id="annualSavings">$0</h2>
                            <p class="mb-0 small text-muted">Potential yearly cost reduction</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card stat-card border-0 shadow-sm h-100">
                        <div class="card-body">
                            <h6 class="text-muted mb-3">
                                <i class="bi bi-speedometer2 me-2"></i>Quick Win Available
                                <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                   title="High-impact actions you can take right now to achieve immediate cost savings. These are the easiest and most impactful optimizations to start with."></i>
                            </h6>
                            <div id="quickWinContent">
                                <p class="mb-0 small">Loading...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card stat-card border-0 shadow-sm h-100" style="border-left: 4px solid #667eea !important;">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-grow-1">
                                    <h6 class="text-muted mb-1">
                                        Total Resources
                                        <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="The total count of this resource type found in your Azure environment. This includes both active (in-use) and orphaned (unused) resources."></i>
                                    </h6>
                                    <h2 class="mb-0" id="totalResources">-</h2>
                                </div>
                                <div class="icon-box">
                                    <i class="{{ resource_info.icon }} fs-3"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stat-card border-0 shadow-sm h-100" style="border-left: 4px solid #dc3545 !important;">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-grow-1">
                                    <h6 class="text-muted mb-1">
                                        Orphaned Resources
                                        <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Resources that are not being used or are disconnected from any active services. These are safe to delete and are costing you money unnecessarily."></i>
                                    </h6>
                                    <h2 class="mb-0 text-danger" id="orphanedCount">-</h2>
                                </div>
                                <div class="icon-box">
                                    <i class="bi bi-exclamation-triangle fs-3"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stat-card border-0 shadow-sm h-100">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-grow-1">
                                    <h6 class="text-muted mb-1">
                                        Active Resources
                                        <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Resources that are currently in use and attached to active services. These should be kept and monitored for optimization opportunities."></i>
                                    </h6>
                                    <h2 class="mb-0 text-success" id="activeCount">-</h2>
                                </div>
                                <div class="icon-box">
                                    <i class="bi bi-check-circle fs-3"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stat-card border-0 shadow-sm h-100">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-grow-1">
                                    <h6 class="text-muted mb-1">
                                        Orphaned %
                                        <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="The percentage of your resources that are orphaned. A lower percentage is better. Rates below 15% are generally considered good, while rates above 30% indicate cleanup is needed."></i>
                                    </h6>
                                    <h2 class="mb-0" id="orphanedPercentage">-</h2>
                                </div>
                                <div class="icon-box">
                                    <i class="bi bi-pie-chart fs-3"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Assessment & Action Priorities -->
            <div class="row mb-4">
                <div class="col-lg-4">
                    <div class="card data-table border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0 py-3">
                            <h5 class="mb-0">
                                <i class="bi bi-shield-exclamation me-2"></i>Risk Assessment
                                <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                   title="Evaluates the potential security, compliance, and operational risks associated with orphaned resources in your environment. Higher risk levels require more urgent attention."></i>
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="riskAssessment">
                                <div class="text-center py-4">
                                    <div class="spinner-border spinner-border-sm" role="status"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8">
                    <div class="card data-table border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0 py-3">
                            <h5 class="mb-0">
                                <i class="bi bi-list-check me-2"></i>Action Priority Matrix
                                <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                   title="Organizes recommended actions by urgency. Urgent items have high cost impact or security risks. High priority offers significant savings. Low priority items improve resource hygiene."></i>
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="actionPriorities">
                                <div class="text-center py-4">
                                    <div class="spinner-border spinner-border-sm" role="status"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendations Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card data-table border-0 shadow-sm">
                        <div class="card-header bg-white border-0 py-3">
                            <div class="d-flex align-items-center justify-content-between">
                                <h5 class="mb-0">
                                    <i class="bi bi-lightbulb me-2" style="background: linear-gradient(135deg, #FFD700, #FFA500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"></i>
                                    Detailed Recommendations
                                    <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                       title="Specific, actionable recommendations to optimize this resource type. Each recommendation includes current state, suggested action, potential savings, and priority level to help you make informed decisions."></i>
                                </h5>
                                <span class="badge" style="background: #000; color: white; border: 2px solid #000; padding: 0.5rem 1rem;" id="recommendationCount">0</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="recommendationsList">
                                <!-- Recommendations will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comparative Benchmarks -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card data-table border-0 shadow-sm">
                        <div class="card-header bg-white border-0 py-3">
                            <h5 class="mb-0">
                                <i class="bi bi-bar-chart me-2"></i>Performance Benchmarks
                                <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                   title="Shows your overall orphan rate, average across resource groups, and identifies your best and worst performing resource groups. Use this to understand which areas need cleanup priority."></i>
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="benchmarksContent">
                                <!-- Benchmarks will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Tables -->
            <div class="row mb-4">
                <div class="col-lg-6 mb-4">
                    <div class="card data-table border-0 shadow-sm">
                        <div class="card-header bg-white border-0 py-3">
                            <h5 class="mb-0">
                                <i class="bi bi-geo-alt me-2"></i>
                                Distribution by Location
                                <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                   title="Shows how your resources are distributed across Azure regions. Identifies which locations have the most orphaned resources."></i>
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Location</th>
                                            <th class="text-end">Total</th>
                                            <th class="text-end">Orphaned</th>
                                            <th class="text-end">Active</th>
                                        </tr>
                                    </thead>
                                    <tbody id="locationStatsTable">
                                        <!-- Data will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 mb-4">
                    <div class="card data-table border-0 shadow-sm">
                        <div class="card-header bg-white border-0 py-3">
                            <h5 class="mb-0">
                                <i class="bi bi-folder me-2"></i>
                                Top Resource Groups
                                <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                   title="Groups your resources by Azure Resource Group. Shows which resource groups have the highest orphan rates, helping you identify organizational areas that need cleanup."></i>
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Resource Group</th>
                                            <th class="text-end">Total</th>
                                            <th class="text-end">Orphaned</th>
                                            <th class="text-end">Active</th>
                                        </tr>
                                    </thead>
                                    <tbody id="resourceGroupTable">
                                        <!-- Data will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orphaned Resources List -->
            <div class="row mb-4" id="orphanedResourcesSection" style="display: none;">
                <div class="col-12">
                    <div class="card data-table border-0 shadow-sm">
                        <div class="card-header bg-white border-0 py-3">
                            <div class="d-flex align-items-center justify-content-between">
                                <h5 class="mb-0">
                                    <i class="bi bi-trash me-2 text-danger"></i>
                                    All Orphaned Resources
                                    <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" data-bs-placement="top" 
                                       title="Complete list of all unused resources detected in this category. Each resource can be safely deleted to reduce costs. Use the Copy ID button to get the resource identifier for deletion."></i>
                                </h5>
                                <span class="badge bg-danger" id="orphanedResourcesCount">0</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Name</th>
                                            <th>Resource Group</th>
                                            <th>Location</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="orphanedResourcesTable">
                                        <!-- Data will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const resourceType = '{{ resource_type }}';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Bootstrap tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            fetchDashboardData();
        });

        async function fetchDashboardData() {
            try {
                const response = await fetch(`/api/data/${resourceType}?source=json`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                // Check if there's an info message (no data scenario)
                if (data.info_message) {
                    const banner = document.getElementById('dataSourceBanner');
                    banner.className = 'alert alert-warning border-0 shadow-sm mb-4';
                    banner.style.borderLeft = '4px solid #FFA500';
                    banner.style.display = 'block';
                    banner.innerHTML = `
                        <div class="d-flex align-items-center">
                            <i class="bi bi-info-circle-fill fs-4 me-3" style="color: #FFA500;"></i>
                            <div class="flex-grow-1">
                                <strong>No Resources Found</strong>
                                <p class="mb-0 small">${data.info_message}</p>
                            </div>
                            <a href="/overview" class="btn btn-sm btn-outline-warning">
                                <i class="bi bi-arrow-clockwise me-1"></i>
                                Refresh Scan
                            </a>
                        </div>
                    `;
                } else {
                    // Show data source banner
                    const banner = document.getElementById('dataSourceBanner');
                    banner.className = 'alert alert-info border-0 shadow-sm mb-4';
                    banner.style.borderLeft = '4px solid #667eea';
                    banner.style.display = 'block';
                    banner.innerHTML = `
                        <div class="d-flex align-items-center">
                            <i class="bi bi-cloud-check-fill fs-4 me-3" style="color: #667eea;"></i>
                            <div class="flex-grow-1">
                                <strong>Using Azure Scan Data</strong>
                                <p class="mb-0 small text-muted">
                                    Loaded from: <code>${data.scan_file}</code> | 
                                    Scanned: ${new Date(data.scan_date).toLocaleString()}
                                </p>
                            </div>
                            <a href="/overview" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-arrow-clockwise me-1"></i>
                                Refresh Scan
                            </a>
                        </div>
                    `;
                }
                
                // Populate cost impact
                if (data.cost_impact) {
                    document.getElementById('monthlyWaste').textContent = '$' + data.cost_impact.monthly_waste.toFixed(0);
                    document.getElementById('annualSavings').textContent = '$' + data.cost_impact.annual_savings.toFixed(0);
                    
                    const quickWinDiv = document.getElementById('quickWinContent');
                    if (data.cost_impact.quick_wins && data.cost_impact.quick_wins.length > 0) {
                        quickWinDiv.innerHTML = data.cost_impact.quick_wins.map(qw => 
                            `<p class="mb-1 small"><strong>${qw.action}</strong></p>
                             <p class="mb-0 text-success small">Save: ${qw.savings}</p>`
                        ).join('');
                    } else {
                        quickWinDiv.innerHTML = '<p class="mb-0 small text-muted">No immediate quick wins identified</p>';
                    }
                }
                
                // Populate summary
                document.getElementById('totalResources').textContent = data.summary.total_resources;
                document.getElementById('orphanedCount').textContent = data.summary.orphaned_count;
                document.getElementById('activeCount').textContent = data.summary.active_count;
                document.getElementById('orphanedPercentage').textContent = data.summary.orphaned_percentage + '%';
                
                // Populate risk assessment
                if (data.risk_assessment) {
                    populateRiskAssessment(data.risk_assessment);
                }
                
                // Populate action priorities
                if (data.action_priorities) {
                    populateActionPriorities(data.action_priorities);
                }
                
                // Populate benchmarks
                if (data.benchmarks) {
                    populateBenchmarks(data.benchmarks);
                }
                
                // Populate recommendations
                populateRecommendations(data.recommendations);
                
                // Populate location stats
                populateLocationStats(data.location_stats);
                
                // Populate resource group stats
                populateResourceGroupStats(data.resource_group_stats);
                
                // Populate orphaned resources if any
                if (data.orphaned_resources && data.orphaned_resources.length > 0) {
                    document.getElementById('orphanedResourcesSection').style.display = 'block';
                    populateOrphanedResources(data.orphaned_resources);
                }
                
                // Hide loading, show content
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
            } catch (error) {
                console.error('Error fetching dashboard data:', error);
                document.getElementById('loadingSpinner').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>Error loading data:</strong> ${error.message}<br>
                        <a href="/overview" class="btn btn-primary mt-3">Run Azure Scan</a>
                    </div>
                `;
            }
        }

        function populateRecommendations(recommendations) {
            const container = document.getElementById('recommendationsList');
            document.getElementById('recommendationCount').textContent = recommendations.length;
            
            if (recommendations.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-success border-0" style="border: 2px solid #000 !important; border-left: 4px solid #000 !important;">
                        <i class="bi bi-check-circle"></i>
                        Great! No major cost optimization issues detected. Continue monitoring your resources.
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            recommendations.forEach((rec) => {
                const priorityStyle = rec.priority === 'Critical'
                    ? 'background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white;'
                    : rec.priority === 'High' 
                    ? 'background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;'
                    : rec.priority === 'Medium'
                    ? 'background: linear-gradient(135deg, #FFD700, #FFA500); color: white;'
                    : 'background: linear-gradient(135deg, #4ECDC4, #95E1D3); color: white;';
                
                const card = document.createElement('div');
                card.className = 'recommendation-item p-3 mb-3';
                card.innerHTML = `
                    <div class="d-flex align-items-start">
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center mb-2">
                                <h6 class="mb-0 me-2">${rec.type.replace(/_/g, ' ').toUpperCase()}</h6>
                                <span class="badge" style="${priorityStyle} padding: 0.5rem 1rem; border: none;">${rec.priority}</span>
                            </div>
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <strong class="small d-block mb-1" style="color: #000;">Resource:</strong>
                                    <p class="mb-0 small">${rec.resource}</p>
                                </div>
                                <div class="col-md-3">
                                    <strong class="small d-block mb-1" style="color: #000;">Current State:</strong>
                                    <p class="mb-0 small">${rec.current_state}</p>
                                </div>
                                <div class="col-md-4">
                                    <strong class="small d-block mb-1" style="color: #000;">Suggestion:</strong>
                                    <p class="mb-0 small" style="color: #667eea; font-weight: 500;">${rec.suggestion}</p>
                                </div>
                                <div class="col-md-2">
                                    <strong class="small d-block mb-1" style="color: #000;">Impact:</strong>
                                    <p class="mb-0 small text-muted">${rec.impact || 'Cost optimization'}</p>
                                </div>
                            </div>
                            <div class="mt-2">
                                <span class="badge bg-success">${rec.potential_saving}</span>
                            </div>
                        </div>
                        <div class="ms-3">
                            <i class="bi bi-lightbulb-fill fs-3" style="background: linear-gradient(135deg, #FFD700, #FFA500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"></i>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function populateLocationStats(stats) {
            const tbody = document.getElementById('locationStatsTable');
            tbody.innerHTML = '';
            
            stats.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'resource-row';
                tr.innerHTML = `
                    <td><strong>${row.Location}</strong></td>
                    <td class="text-end">${row.Total}</td>
                    <td class="text-end text-danger">${row.Orphaned}</td>
                    <td class="text-end text-success">${row.Active}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function populateResourceGroupStats(stats) {
            const tbody = document.getElementById('resourceGroupTable');
            tbody.innerHTML = '';
            
            stats.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'resource-row';
                tr.innerHTML = `
                    <td><strong>${row.ResourceGroup}</strong></td>
                    <td class="text-end">${row.Total}</td>
                    <td class="text-end text-danger">${row.Orphaned}</td>
                    <td class="text-end text-success">${row.Active}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function populateRiskAssessment(riskData) {
            const container = document.getElementById('riskAssessment');
            
            const levelColors = {
                'High': 'danger',
                'Medium': 'warning',
                'Low': 'success',
                'None': 'secondary'
            };
            
            const levelColor = levelColors[riskData.level] || 'secondary';
            
            let html = `
                <div class="text-center mb-3">
                    <h3 class="text-${levelColor}"><i class="bi bi-shield-${riskData.level === 'High' ? 'x' : riskData.level === 'Medium' ? 'exclamation' : 'check'}"></i></h3>
                    <h5 class="text-${levelColor}">${riskData.level} Risk</h5>
                </div>
            `;
            
            if (riskData.items && riskData.items.length > 0) {
                html += '<ul class="list-unstyled">';
                riskData.items.forEach(item => {
                    html += `<li class="mb-2"><i class="bi bi-dot text-${levelColor}"></i> ${item}</li>`;
                });
                html += '</ul>';
            } else {
                html += '<p class="text-muted small mb-0">No risk items identified</p>';
            }
            
            container.innerHTML = html;
        }

        function populateActionPriorities(priorities) {
            const container = document.getElementById('actionPriorities');
            
            let html = '';
            
            // Urgent items
            if (priorities.urgent && priorities.urgent.length > 0) {
                html += `
                    <div class="mb-3">
                        <h6 class="text-danger"><i class="bi bi-exclamation-circle-fill me-2"></i>URGENT (Do Now)</h6>
                        <ul class="list-unstyled ms-3">
                `;
                priorities.urgent.forEach(item => {
                    html += `<li class="mb-2">• <strong>${item.title}:</strong> ${item.action} <span class="badge bg-danger">${item.savings}</span></li>`;
                });
                html += '</ul></div>';
            }
            
            // High priority items
            if (priorities.high && priorities.high.length > 0) {
                html += `
                    <div class="mb-3">
                        <h6 class="text-warning"><i class="bi bi-exclamation-triangle-fill me-2"></i>HIGH PRIORITY (This Week)</h6>
                        <ul class="list-unstyled ms-3">
                `;
                priorities.high.forEach(item => {
                    html += `<li class="mb-2">• <strong>${item.title}:</strong> ${item.action} <span class="badge bg-warning text-dark">${item.savings}</span></li>`;
                });
                html += '</ul></div>';
            }
            
            // Low priority items
            if (priorities.low && priorities.low.length > 0) {
                html += `
                    <div class="mb-3">
                        <h6 class="text-success"><i class="bi bi-info-circle-fill me-2"></i>LOW PRIORITY (This Month)</h6>
                        <ul class="list-unstyled ms-3">
                `;
                priorities.low.forEach(item => {
                    html += `<li class="mb-2">• <strong>${item.title}:</strong> ${item.action} <span class="badge bg-success">${item.savings}</span></li>`;
                });
                html += '</ul></div>';
            }
            
            if (!html) {
                html = '<p class="text-muted mb-0">No action items required at this time</p>';
            }
            
            container.innerHTML = html;
        }

        function populateBenchmarks(benchmarks) {
            const container = document.getElementById('benchmarksContent');
            
            // Determine status based on orphan rate thresholds
            let status = 'Good';
            let statusColor = 'success';
            if (benchmarks.your_orphan_rate > 30) {
                status = 'Needs Attention';
                statusColor = 'danger';
            } else if (benchmarks.your_orphan_rate > 15) {
                status = 'Room for Improvement';
                statusColor = 'warning';
            }
            
            let html = `
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="text-center p-3 border rounded">
                            <h6 class="text-muted mb-2">Overall Orphan Rate</h6>
                            <h2 class="text-${statusColor}">${benchmarks.your_orphan_rate}%</h2>
                            <span class="badge bg-${statusColor}">${status}</span>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="text-center p-3 border rounded">
                            <h6 class="text-muted mb-2">Avg Across Resource Groups</h6>
                            <h2>${benchmarks.avg_rg_orphan_rate}%</h2>
                            <small class="text-muted">Internal Average</small>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="text-center p-3 border rounded">
                            <h6 class="text-muted mb-2">Resource Groups Analyzed</h6>
                            <h2 class="text-primary">${benchmarks.total_rg_count}</h2>
                            <small class="text-muted">In Your Environment</small>
                        </div>
                    </div>
                </div>
            `;
            
            if (benchmarks.best_rg || benchmarks.worst_rg) {
                html += '<hr><div class="row">';
                
                if (benchmarks.best_rg) {
                    html += `
                        <div class="col-md-6">
                            <h6><i class="bi bi-trophy text-success"></i> Best Performing RG</h6>
                            <p class="mb-0"><strong>${benchmarks.best_rg.name}</strong></p>
                            <p class="text-success small">${benchmarks.best_rg.rate}% orphan rate</p>
                        </div>
                    `;
                }
                
                if (benchmarks.worst_rg) {
                    html += `
                        <div class="col-md-6">
                            <h6><i class="bi bi-exclamation-triangle text-danger"></i> Needs Attention</h6>
                            <p class="mb-0"><strong>${benchmarks.worst_rg.name}</strong></p>
                            <p class="text-danger small">${benchmarks.worst_rg.rate}% orphan rate - Priority cleanup target</p>
                        </div>
                    `;
                }
                
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        function populateOrphanedResources(resources) {
            const tbody = document.getElementById('orphanedResourcesTable');
            tbody.innerHTML = '';
            
            // Update count badge
            document.getElementById('orphanedResourcesCount').textContent = resources.length;
            
            resources.forEach(resource => {
                const tr = document.createElement('tr');
                tr.className = 'resource-row';
                tr.innerHTML = `
                    <td><strong>${resource.name}</strong></td>
                    <td>${resource.resource_group}</td>
                    <td>${resource.location}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger" onclick="copyResourceId('${resource.id}')">
                            <i class="bi bi-clipboard"></i> Copy ID
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function copyResourceId(id) {
            navigator.clipboard.writeText(id).then(() => {
                alert('Resource ID copied to clipboard');
            });
        }
    </script>
{% endblock %}
